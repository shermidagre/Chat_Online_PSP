version: '3.8'

services:
  servicio-usuarios:
    build: servicio-usuarios # Usar imagen de Docker Hub
    container_name: servicio-usuarios
    restart: on-failure
    ports:
      - "8080:8080"
    environment:
      - spring.datasource.url=jdbc:postgresql://aws-1-eu-central-1.pooler.supabase.com:6543/postgres
      - spring.datasource.username=postgres.zwpzkpaazbjctraqwxky
      - spring.datasource.password=noseloqueponer
      - jwt.secret=MiClaveSecretaSuperSeguraParaJWTQueEsMuyLargaYComplejaParaQueNadieLaAdivine

  servicio-chat:
    build: ./servicio-chat # Construir desde el Dockerfile local
    container_name: servicio-chat
    restart: on-failure
    depends_on:
      - servicio-usuarios
    ports:
      - "8081:8081"
    environment:
      - user-service.url=http://servicio-usuarios:8080

  frontend:
    build: ./frontend
    container_name: frontend
    restart: on-failure
    depends_on:
      - servicio-usuarios # Frontend needs backend to be available for API calls
      - servicio-chat # Frontend needs chat service for WebSocket connection
    ports:
      - "3000:80" # Map host port 3000 to container port 80 (Nginx default)
    environment:
      - CHOKIDAR_USEPOLLING=true # For hot-reloading in some environments


